FROM python:3.10-slim

WORKDIR /app

# Copy requirements and install dependencies
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# Copy the ingestor script
COPY scripts/ws_ingest.py /app/ws_ingest.py

# Create data directory for raw tick storage
RUN mkdir -p /app/data/raw

# Set environment variables with defaults
ENV WS_URL="wss://advanced-trade-ws.coinbase.com"
ENV PRODUCT_IDS="BTC-USD"
ENV KAFKA_BOOTSTRAP_SERVERS="kafka:9092"
ENV KAFKA_TOPIC="ticks.raw"
ENV BACKOFF_BASE="1.0"
ENV BACKOFF_MAX="60.0"

# Run the ingestor
CMD ["python3", "/app/ws_ingest.py"]


